#win的Defender Remover
点击 病毒和威胁防护 (盾牌图标)。
点击“病毒和威胁防护设置”下的 管理设置。
关掉【篡改防护】 (Tamper Protection)。
注意： 此时 UAC 会弹窗报警，点“是”。
实时防护、云提供的保护、自动提交样本 全部关掉。

#关闭 VBS / HVCI (内核隔离)
Win + R 输入 msinfo32或者Get-CimInstance -ClassName Win32_DeviceGuard -Namespace root\Microsoft\Windows\DeviceGuard#VirtualizationBasedSecurityStatus 0（关）
bcdedit /set hypervisorlaunchtype off
reg add "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard" /v "EnableVirtualizationBasedSecurity" /t REG_DWORD /d 0 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard\Scenarios\HypervisorEnforcedCodeIntegrity" /v "Enabled" /t REG_DWORD /d 0 /f

<#
.SYNOPSIS
    Win11 25H2 阿里云 SA 专用满血优化脚本 (Final v2.0)
    Target: i5 + MX350 + 32GB RAM
    Updates: 移除电源计划修改，新增系统去臃肿(Debloat)，集成手动确认清单
#>

# 0. 提权检查
if (!([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Warning "【权限不足】请右键本脚本，选择 [以管理员身份运行] !"
    Start-Sleep -Seconds 3
    Exit
}

# 1. 环境初始化
Clear-Host
$host.UI.RawUI.WindowTitle = "Win11 25H2 - SA 极限优化部署中 (v2.0)"
$cPass = "Green"; $cFail = "Red"; $cWarn = "Yellow"; $cTxt = "White"; $cDim = "Gray"

function Apply-Tweak ($Name, $ScriptBlock, $Note) {
    Write-Host "正在优化: $Name ..." -NoNewline -ForegroundColor $cTxt
    try {
        Invoke-Command -ScriptBlock $ScriptBlock
        Write-Host " [完成]" -ForegroundColor $cPass
        if ($Note) { Write-Host "    -> $Note" -ForegroundColor $cDim }
    } catch {
        Write-Host " [失败]" -ForegroundColor $cFail
        Write-Host "    错误信息: $_" -ForegroundColor $cFail
    }
    Write-Host ""
}

Write-Host "==========================================================" -ForegroundColor Cyan
Write-Host "      WIN11 25H2 核心性能释放脚本 (去臃肿增强版)          " -ForegroundColor Cyan
Write-Host "==========================================================" -ForegroundColor Cyan
Write-Host ""

# --- [核心大头 1] CPU 性能释放 (Spectre/Meltdown) ---
Apply-Tweak "禁用幽灵/熔断补丁 (Spectre/Meltdown)" {
    # 物理外挂：移除 Intel CPU 的分支预测限制
    reg add "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" /v FeatureSettingsOverride /t REG_DWORD /d 3 /f | Out-Null
    reg add "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" /v FeatureSettingsOverrideMask /t REG_DWORD /d 3 /f | Out-Null
} "移除 CPU 预测执行限制，提升单核响应"

# --- [核心大头 2] 虚拟化层解除 (VBS/HVCI) ---
Apply-Tweak "禁用 VBS (基于虚拟化的安全性)" {
    # 性能封印解除
    reg add "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard" /v "EnableVirtualizationBasedSecurity" /t REG_DWORD /d 0 /f | Out-Null
    reg add "HKLM\SYSTEM\CurrentControlSet\Control\DeviceGuard\Scenarios\HypervisorEnforcedCodeIntegrity" /v "Enabled" /t REG_DWORD /d 0 /f | Out-Null
} "释放被安全层吃掉的 15% 算力"

# --- [核心大头 3] 显卡调度 (HAGS) ---
Apply-Tweak "启用 GPU 硬件加速计划 (HAGS)" {
    # MX350 救星
    reg add "HKLM\SYSTEM\CurrentControlSet\Control\GraphicsDrivers" /v "HwSchMode" /t REG_DWORD /d 2 /f | Out-Null
} "降低 CPU 调度负担，显卡接管显存"

# --- [核心大头 4] 32GB 内存特权 (Memory) ---
Apply-Tweak "禁用内存压缩 (Memory Compression)" {
    # 32G 内存无需压缩
    Disable-MMAgent -mc -ErrorAction SilentlyContinue
} "消除窗口切换微卡顿，CPU 直通内存"

# --- [核心大头 5] 磁盘空间与寿命 (Hibernate) ---
Apply-Tweak "关闭系统休眠" {
    powercfg -h off
} "释放 30GB+ C盘空间，减少写入"

# --- [核心大头 6] 网络防抖 (RSC) ---
Apply-Tweak "禁用网络 RSC (防断流)" {
    netsh int tcp set global rsc=disabled | Out-Null
} "解决 Win11 WiFi 跳 Ping 和 SSH 断连"


# --- [新增大头] 系统去臃肿 (Debloat) ---
Apply-Tweak "卸载系统臃肿应用 (后台大户)" {
    # 既然你不打游戏且追求极致，这些后台常驻的 UWP 必须杀掉
    $bloatware = @(
        "Microsoft.Xbox*",              # Xbox 全家桶 (不玩游戏必删)
        "Microsoft.WindowsFeedbackHub", # 反馈中心 (后台遥测大户)
        "Microsoft.GetHelp",            # 帮助与提示 (没什么用)
        "Microsoft.Getstarted",         # 入门提示
        "Microsoft.BingWeather",        # 天气 (Widgets 后台占用源)
        "Microsoft.MicrosoftSolitaireCollection", # 纸牌游戏
        "Microsoft.YourPhone",          # 手机连接 (如果不连安卓手机就删)
        "Microsoft.People",             # 人脉
        "Microsoft.Microsoft3DViewer",  # 3D 查看器
        "Microsoft.MixedReality.Portal" # 混合现实门户
    )
    foreach ($app in $bloatware) {
        Get-AppxPackage $app -ErrorAction SilentlyContinue | Remove-AppxPackage -ErrorAction SilentlyContinue
    }
} "清理后台潜伏进程，释放内存和 I/O"

# --- [手动确认环节] ---
Write-Host ""
Write-Host "==========================================================" -ForegroundColor $cTxt -BackgroundColor DarkBlue
Write-Host "   【最后的手动确认】 (脚本无法修改，请务必肉眼确认)       " -ForegroundColor $cWarn
Write-Host "    1. [散热] 按 Fn+Q -> 确保灯变红 (联想野兽模式)         " -ForegroundColor $cTxt
Write-Host "    2. [硬盘] 设备管理器->磁盘驱动器->策略->[√]写入缓存    " -ForegroundColor $cTxt
Write-Host "    3. [显卡] Nvidia 控制面板->管理3D设置->电源->最高性能  " -ForegroundColor $cTxt
Write-Host "    4. [杀毒] 运行完后，请在 Optimizer 中手动禁用 Defender " -ForegroundColor $cTxt
Write-Host "==========================================================" -ForegroundColor $cTxt -BackgroundColor DarkBlue
Write-Host ""

Pause

Enable-MMAgent -mc



# --- 1. 任务栏净化 (Widgets, Copilot, Chat) ---
Write-Host "正在执行：隐藏任务栏小组件、Copilot、聊天按钮..."
# 隐藏小组件
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "TaskbarDa" -Value 0 -Type DWord -Force
# 隐藏聊天 (Teams)
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "TaskbarMn" -Value 0 -Type DWord -Force
# 隐藏 Copilot (通过策略禁用，更彻底)
$copilotPath = "HKCU:\Software\Policies\Microsoft\Windows\WindowsCopilot"
if (!(Test-Path $copilotPath)) { New-Item -Path $copilotPath -Force | Out-Null }
Set-ItemProperty -Path $copilotPath -Name "TurnOffWindowsCopilot" -Value 1 -Type DWord -Force

# --- 2. 资源管理器习惯 (扩展名, 260字符路径) ---
Write-Host "正在执行：显示文件扩展名、启用长路径支持..."
# 显示已知文件扩展名
Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" -Name "HideFileExt" -Value 0 -Type DWord -Force
# 启用长路径支持 (>260字符)
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\FileSystem" -Name "LongPathsEnabled" -Value 1 -Type DWord -Force

# --- 3. 驱动与更新策略 (防止 MX350 驱动被覆盖) ---
Write-Host "正在执行：禁止 Windows Update 搜索驱动..."
$wuPath = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate"
if (!(Test-Path $wuPath)) { New-Item -Path $wuPath -Force | Out-Null }
Set-ItemProperty -Path $wuPath -Name "ExcludeWUDriversInQualityUpdate" -Value 1 -Type DWord -Force

# --- 4. 性能释放 (SysMain, GPU计划, 休眠) ---
Write-Host "正在执行：禁用 SysMain、关闭休眠、启用 HAGS..."
# 禁用 SysMain (Superfetch)
Stop-Service -Name "SysMain" -Force -ErrorAction SilentlyContinue
Set-Service -Name "SysMain" -StartupType Disabled
# 关闭休眠 (释放 32GB 空间)
powercfg /h off
# 启用硬件加速 GPU 计划 (HAGS) - 对应“开启”
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\GraphicsDrivers" -Name "HwSchMode" -Value 2 -Type DWord -Force

# --- 5. 极端性能优化 (Spectre/Meltdown 补丁禁用) ---
Write-Host "正在执行：禁用幽灵/熔断补丁 (提升 IO 性能)..."
$memPath = "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management"
Set-ItemProperty -Path $memPath -Name "FeatureSettingsOverride" -Value 3 -Type DWord -Force
Set-ItemProperty -Path $memPath -Name "FeatureSettingsOverrideMask" -Value 3 -Type DWord -Force

# --- 6. 刷新资源管理器以生效 UI 更改 ---
Write-Host "正在重启资源管理器..."
Stop-Process -Name explorer -Force
Start-Sleep -Seconds 2
Write-Host "✅ 所有 10 项优化已执行完毕。请务必重启电脑以使系统级设置（HAGS、Spectre、SysMain）完全生效。" -ForegroundColor Green










#!/bin/bash

# 1. 结束 Edge 进程，确保策略能被重新读取
echo "正在关闭 Microsoft Edge..."
pkill "Microsoft Edge" 2>/dev/null

echo "正在写入全部 17 项优化策略..."

# --- 第一组：隐私、后台与广告 (对应图一) ---
# 1. 禁止后台模式
defaults write com.microsoft.Edge BackgroundModeEnabled -bool false
# 2. 【补全】压制 Bing 搜索广告
defaults write com.microsoft.Edge BingAdsSuppression -bool true
# 3. 诊断数据设为 0 (最低)
defaults write com.microsoft.Edge DiagnosticData -int 0
# 4. 隐藏首次运行欢迎页
defaults write com.microsoft.Edge HideFirstRunExperience -bool true
# 5. 禁用 Insider 测试版推广
defaults write com.microsoft.Edge MicrosoftEdgeInsiderPromotionEnabled -bool false
# 6. 禁用个性化报告
defaults write com.microsoft.Edge PersonalizationReportingEnabled -bool false
# 7. 禁用推荐弹窗
defaults write com.microsoft.Edge ShowRecommendationsEnabled -bool false
# 8. 禁用微软积分 (Rewards)
defaults write com.microsoft.Edge ShowMicrosoftRewards -bool false
# 9. 禁用标签页服务 (数据上传)
defaults write com.microsoft.Edge TabServicesEnabled -bool false

# --- 第二组：新标签页与下载 (对应图一) ---
# 10. 新标签页不加载内容 (新闻流)
defaults write com.microsoft.Edge NewTabPageContentEnabled -bool false
# 11. 新标签页隐藏默认热门站点
defaults write com.microsoft.Edge NewTabPageHideDefaultTopSites -bool true
# 13. 关闭不安全下载警告
defaults write com.microsoft.Edge ShowDownloadsInsecureWarningsEnabled -bool false

# --- 第三组：界面干扰与购物 (对应图二) ---
# 14. 禁止右键菜单访问默认搜索
defaults write com.microsoft.Edge DefaultSearchProviderContextMenuAccessAllowed -bool false
# 15. 禁用购物助手
defaults write com.microsoft.Edge EdgeShoppingAssistantEnabled -bool false
# 16. 禁用侧边栏 (Hubs)
defaults write com.microsoft.Edge HubsSidebarEnabled -bool false
# 17. 禁用用户反馈按钮
defaults write com.microsoft.Edge UserFeedbackAllowed -bool false

# --- 刷新配置缓存 ---
echo "正在刷新系统配置缓存..."
killall cfprefsd

echo "✅ 17项策略已全部写入完成！请重新打开 Edge 检查 edge://policy"





#精简版本

# 1. 强制关闭 Edge，确保策略能写入
echo "正在关闭 Microsoft Edge..."
pkill "Microsoft Edge" 2>/dev/null

defaults write com.microsoft.Edge BackgroundModeEnabled -bool false
defaults write com.microsoft.Edge BingAdsSuppression -bool true
defaults write com.microsoft.Edge DiagnosticData -int 0
defaults write com.microsoft.Edge HideFirstRunExperience -bool true
defaults write com.microsoft.Edge MicrosoftEdgeInsiderPromotionEnabled -bool false
defaults write com.microsoft.Edge PersonalizationReportingEnabled -bool false
defaults write com.microsoft.Edge ShowRecommendationsEnabled -bool false
defaults write com.microsoft.Edge ShowMicrosoftRewards -bool false
defaults write com.microsoft.Edge TabServicesEnabled -bool false
defaults write com.microsoft.Edge NewTabPageContentEnabled -bool false
defaults write com.microsoft.Edge NewTabPageHideDefaultTopSites -bool true
defaults write com.microsoft.Edge ShowDownloadsInsecureWarningsEnabled -bool false
defaults write com.microsoft.Edge DefaultSearchProviderContextMenuAccessAllowed -bool false
defaults write com.microsoft.Edge EdgeShoppingAssistantEnabled -bool false
defaults write com.microsoft.Edge HubsSidebarEnabled -bool false
defaults write com.microsoft.Edge UserFeedbackAllowed -bool false

# --- 刷新配置缓存 ---
echo "正在刷新系统配置缓存..."
killall cfprefsd

echo "✅ 最终代码执行完毕！所有策略（含后台模式）已生效。"
