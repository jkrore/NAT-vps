# NAT-vps 网络性能终极优化脚本集

本项目提供了一套针对 Debian 12/13 系统的网络性能优化脚本，旨在最大化 NAT VPS 或独立服务器的网络吞吐能力和响应速度。

脚本分为两个核心部分，需要按顺序执行：
1.  **`vip1.sh`**: 环境准备脚本，负责更新系统、安装所有必要的依赖工具，并配置好 XanMod 内核的软件源。**此脚本绝对安全，不会修改系统核心组件，也不会导致无法启动。**
2.  **`vip2.sh`**: 核心优化脚本，执行包括 BBRv3 内核安装、TCP/UDP 缓冲区优化、网卡硬件调优等一系列高级操作。

---

## 🚀 快速开始 (推荐流程)

此流程适用于一台刚刚 `dd` 完的、纯净的 Debian 12/13 系统。请以 `root` 用户身份登录服务器，然后按顺序执行以下步骤。

### 步骤一：执行环境准备脚本 (`vip1.sh`)

此脚本会为后续的核心优化做好一切准备工作。

```bash
curl -sL https://raw.githubusercontent.com/jkrore/NAT-vps/main/vip1.sh | bash
```

等待此脚本执行完毕，看到 "✅ 黄金准备脚本执行完毕！" 的提示信息。

### 步骤二：执行核心优化脚本 (`vip2.sh`)

在准备工作完成后，运行此脚本来应用所有网络优化。

**基础用法 (推荐):**

此命令会启用所有优化、尝试安装 XanMod 内核 (BBRv3)，并根据您的服务器状况自动检测网络参数。

```bash
curl -sL https://raw.githubusercontent.com/jkrore/NAT-vps/main/vip2.sh | bash -s -- --apply --install-xanmod
```

**高级用法 (自定义参数):**

如果您对自己的网络环境有更精确的了解，可以通过附加参数进行微调。

```bash
curl -sL https://raw.githubusercontent.com/jkrore/NAT-vps/main/vip2.sh | bash -s -- --apply --install-xanmod --mode aggressive --rtt 200
```

脚本执行完毕后，如果成功安装了 XanMod 内核，会提示您需要重启。请手动执行 `reboot` 命令重启服务器，以加载新内核。

---

## 🛠️ `vip2.sh` 核心优化脚本参数详解

您可以通过组合不同的参数来定制优化策略。所有参数都需要加在 `--` 之后。

*   `--apply`
    *   **必需参数**。默认情况下，脚本只进行“演习”（Dry Run），不会应用任何更改。使用此参数后，所有优化才会真正写入系统。

*   `--install-xanmod`
    *   **强烈推荐**。尝试安装集成了最新 BBRv3 算法的 XanMod 内核，这是获得最大性能提升的关键。

*   `--mode <模式>`
    *   **可选参数**。用于设定优化策略的倾向性。默认为 `aggressive`。
    *   `aggressive`: 激进模式。最大化缓冲区，追求最高吞吐量，适合大流量下载/上传。
    *   `normal`: 普通模式。在吞吐量和资源占用之间取得平衡。
    *   `latency`: 低延迟模式。牺牲一部分吞吐量，优先保证网络响应速度，适合游戏代理等场景。

*   `--rtt <毫秒>`
    *   **可选参数**。手动指定您服务器到目标区域的平均 RTT (延迟)，单位为毫秒。例如 `--rtt 200`。
    *   脚本会自动检测 RTT，但如果检测不准或您有更精确的数值，可以使用此参数覆盖。

*   `--bandwidth <Mbps>`
    *   **可选参数**。手动指定您服务器的带宽，单位为 Mbps。例如 `--bandwidth 1000`。
    *   脚本会自动估算带宽，但手动指定可以获得更精确的缓冲区计算结果。

*   `--enable-xdp`
    *   **可选参数，专家使用**。尝试启用 XDP (eXpress Data Path) 功能，用于超低延迟的数据包处理。需要内核头文件支持，不保证成功。

---

## ⚠️ 故障排查

如果执行完 `vip2.sh` 并重启后，服务器无法通过 SSH 连接，这极有可能是新安装的 XanMod 内核与您 VPS 的底层虚拟化驱动不兼容。

**解决方案：**
1.  通过您 VPS 提供商后台的 **VNC / KVM 控制台**登录服务器。
2.  重启服务器，并在启动菜单 (GRUB) 中选择带有 "Debian" 字样**旧内核**启动。
3.  成功登录后，执行卸载命令移除 XanMod 内核，然后再次 `update-grub` 即可恢复。

在这种情况下，您的系统依然应用了除更换内核之外的所有优化（如大缓冲区、BBR开启等），性能同样远超默认状态。
