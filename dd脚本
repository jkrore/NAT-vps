#æ­å»º hostnamectl set-hostname åå­—  ğŸ¦„ğŸ• ğŸš€ğŸŒ
vmpt="54321" vlpt="1000" xhpt="1001" vxpt="1002" arpt="2003" anpt="2002" hypt="2000" tupt="2001" name="ğŸ²â„¢ï¸ã€è¯·å‹¿æµ‹é€Ÿã€‘"  argo="y"  bash <(curl -Ls https://raw.githubusercontent.com/yonggekkk/argosbx/main/argosbx.sh)

#xray
bash <(wget -qO- https://raw.githubusercontent.com/fscarmen/argox/main/argox.sh) -c

#ddè„šæœ¬
#æ›´æ–° apt update && apt install curl -y
vlpt="1000" xhpt="1001" vxpt="1002" arpt="2003" anpt="2002" hypt="2000" tupt="2001" name="gode" bash <(curl -Ls https://raw.githubusercontent.com/yonggekkk/argosbx/main/argosbx.sh)
vmpt="54321" vlpt="1000" xhpt="1001" vxpt="1002" arpt="2003" anpt="2002" hypt="2000" tupt="2001" name="gode" cdnym="sp1.godeluoo.eu.org" argo="y" agn="sp2.godeluoo.eu.org" agk="eyJhIjoiZTc3ODQ0NmNjMTlkZGIwNWM1ZDMyODFmMzMzMDhhZWEiLCJ0IjoiYzI3ZjAyMTgtNzEwYS00OTZmLWIzZDItMzI3ZGMzNGViYTRmIiwicyI6Ik9UZGlNbVl4TjJFdE5tSTBNUzAwT0RZeExUZzVOR0V0TVRjMFpEUmlOemRpWlRJeiJ9" bash <(curl -Ls https://raw.githubusercontent.com/yonggekkk/argosbx/main/argosbx.sh)
#é‡ç½®
curl -O https://raw.githubusercontent.com/bin456789/reinstall/main/reinstall.sh || wget -O ${_##*/} $_
bash reinstall.sh debian 13 --ssh-port 22 --web-port 8080 --password "Huawei@123..."

#æš´åŠ›å‘åŒ…
apt-get install linux-headers-$(uname -r) -y
#æ¢å†…æ ¸
bash <(curl -l -s https://raw.githubusercontent.com/byJoey/Actions-bbr-v3/refs/heads/main/install.sh)
wget -O tcpx.sh "https://github.com/ylx2016/Linux-NetSpeed/raw/master/tcpx.sh" && chmod +x tcpx.sh && ./tcpx.sh






#è™šæ‹Ÿå†…å­˜
git clone --recurse-submodules https://github.com/ecdye/zram-config && cd zram-config && ./install.bash


#!/bin/bash

# ===================================================================================
#
#         ZRAM + ç£ç›˜Swap æ··åˆéƒ¨ç½²è„šæœ¬ v2.0 (æœ€ç»ˆÂ·ä¸€é”®Â·å®Œæ•´ç‰ˆ)
#
#   æœ¬è„šæœ¬å°†è‡ªåŠ¨é…ç½®ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯é çš„æ··åˆäº¤æ¢ç©ºé—´æ–¹æ¡ˆï¼š
#   1. ZRAM (é«˜ä¼˜å…ˆçº§): ç”¨äºå¿«é€Ÿå“åº”ï¼Œå¤„ç†æ—¥å¸¸å†…å­˜å‹åŠ›ã€‚
#   2. ç£ç›˜Swap (ä½ä¼˜å…ˆçº§): ä½œä¸ºåå¤‡ï¼Œé˜²æ­¢æç«¯æƒ…å†µä¸‹çš„ OOMã€‚
#
# ===================================================================================

# --- (1) ç”¨æˆ·é…ç½®åŒº ---
# (å·²ä¸º 2GB ç‰©ç†å†…å­˜è®¾ç½®æ¨èå€¼)
ZRAM_SIZE="1G"                # ZRAM å¤§å° (æ¨èä¸ºç‰©ç†å†…å­˜çš„ 50%)
ZRAM_PRIORITY="100"           # ZRAM ä¼˜å…ˆçº§ (å¿…é¡»é«˜äºç£ç›˜Swap)
COMP_ALGORITHM="lz4"          # ZRAM å‹ç¼©ç®—æ³• (lz4é€Ÿåº¦æœ€å¿«, zstdå‹ç¼©ç‡æ›´é«˜)

DISK_SWAP_SIZE="1G"           # ç£ç›˜Swapæ–‡ä»¶å¤§å° (æ¨èä¸ZRAMå¤§å°ç›¸å½“æˆ–æ›´å¤§)
DISK_SWAP_PRIORITY="10"       # ç£ç›˜Swap ä¼˜å…ˆçº§ (å¿…é¡»ä½äºZRAM)
DISK_SWAP_PATH="/swapfile"    # ç£ç›˜Swapæ–‡ä»¶çš„è·¯å¾„
# -------------------------


# --- è„šæœ¬æ ¸å¿ƒå˜é‡ (è¯·å‹¿ä¿®æ”¹) ---
ZRAM_SERVICE_NAME="zram-swap.service"
ZRAM_SERVICE_FILE="/etc/systemd/system/$ZRAM_SERVICE_NAME"
ZRAM_SCRIPT_PATH="/usr/local/sbin/zram-swap-control"

# --- è¾…åŠ©å‡½æ•° (è¯·å‹¿ä¿®æ”¹) ---
_log() { echo -e "\e[1;32mâœ” $1\e[0m"; }
_warn() { echo -e "\e[1;33mâš  $1\e[0m"; }
_error() { echo -e "\e[1;31mâœ– $1\e[0m"; exit 1; }
_title() { echo -e "\n\e[1;34m--- $1 ---\e[0m"; }

# --- ZRAM æ§åˆ¶å‡½æ•° ---
do_start_zram() {
    modprobe zram num_devices=1
    sleep 1
    echo 1 > /sys/class/block/zram0/reset
    echo "$COMP_ALGORITHM" > /sys/class/block/zram0/comp_algorithm
    echo "$ZRAM_SIZE" > /sys/class/block/zram0/disksize
    mkswap /dev/zram0
    swapon /dev/zram0 -p "$ZRAM_PRIORITY"
}
do_stop_zram() {
    swapoff /dev/zram0 2>/dev/null
    echo 1 > /sys/class/block/zram0/reset 2>/dev/null
}

# --- ZRAM å®‰è£…/å¸è½½ ---
do_install_zram() {
    _title "éƒ¨ç½² ZRAM (é«˜ä¼˜å…ˆçº§)"
    # åˆ›å»º systemd æœåŠ¡æ–‡ä»¶
    cat << EOF > "$ZRAM_SERVICE_FILE"
[Unit]
Description=ZRAM Swap (High Priority)
After=multi-user.target

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=$ZRAM_SCRIPT_PATH start
ExecStop=$ZRAM_SCRIPT_PATH stop

[Install]
WantedBy=multi-user.target
EOF
    # åˆ›å»ºè¢«æœåŠ¡è°ƒç”¨çš„æ§åˆ¶è„šæœ¬
    cat << EOF > "$ZRAM_SCRIPT_PATH"
#!/bin/bash
# ZRAM æ§åˆ¶è„šæœ¬ï¼Œç”±ä¸»è„šæœ¬ç”Ÿæˆ
ZRAM_SIZE="$ZRAM_SIZE"
COMP_ALGORITHM="$COMP_ALGORITHM"
ZRAM_PRIORITY="$ZRAM_PRIORITY"
$(declare -f do_start_zram)
$(declare -f do_stop_zram)
case "\$1" in start) do_start_zram ;; stop) do_stop_zram ;; *) exit 1 ;; esac
EOF
    chmod +x "$ZRAM_SCRIPT_PATH"
    systemctl daemon-reload
    systemctl enable "$ZRAM_SERVICE_NAME"
    systemctl restart "$ZRAM_SERVICE_NAME"
    _log "ZRAM æœåŠ¡å·²é…ç½®å¹¶å¯åŠ¨ã€‚"
}
do_uninstall_zram() {
    systemctl disable --now "$ZRAM_SERVICE_NAME" 2>/dev/null
    rm -f "$ZRAM_SERVICE_FILE" "$ZRAM_SCRIPT_PATH"
    systemctl daemon-reload
    _log "ZRAM å·²å¸è½½ã€‚"
}

# --- ç£ç›˜Swap å®‰è£…/å¸è½½ ---
do_install_disk_swap() {
    _title "éƒ¨ç½² ç£ç›˜Swap (ä½ä¼˜å…ˆçº§)"
    if grep -q "$DISK_SWAP_PATH" /proc/swaps; then
        _warn "ç£ç›˜Swapå·²æ¿€æ´»ï¼Œè·³è¿‡åˆ›å»ºã€‚"
    elif [ -f "$DISK_SWAP_PATH" ]; then
        _warn "ç£ç›˜Swapæ–‡ä»¶å·²å­˜åœ¨ï¼Œå°†ç›´æ¥æ¿€æ´»ã€‚"
    else
        _log "åˆ›å»ºå¤§å°ä¸º ${DISK_SWAP_SIZE} çš„Swapæ–‡ä»¶..."
        fallocate -l "$DISK_SWAP_SIZE" "$DISK_SWAP_PATH"
        chmod 600 "$DISK_SWAP_PATH"
        mkswap "$DISK_SWAP_PATH"
    fi
    swapon --priority "$DISK_SWAP_PRIORITY" "$DISK_SWAP_PATH"
    # å†™å…¥ fstab å®ç°æŒä¹…åŒ–
    if ! grep -q "$DISK_SWAP_PATH" /etc/fstab; then
        echo "$DISK_SWAP_PATH none swap sw,pri=$DISK_SWAP_PRIORITY 0 0" >> /etc/fstab
        _log "ç£ç›˜Swapå·²å†™å…¥ /etc/fstab ä»¥å®ç°å¼€æœºè‡ªå¯ã€‚"
    fi
    _log "ç£ç›˜Swapå·²æ¿€æ´»ã€‚"
}
do_uninstall_disk_swap() {
    swapoff "$DISK_SWAP_PATH" 2>/dev/null
    # ä» fstab ä¸­ç§»é™¤ï¼Œä½¿ç”¨'|'ä½œä¸ºåˆ†éš”ç¬¦ä»¥é¿å…è·¯å¾„ä¸­çš„'/'å†²çª
    sed -i "\|$DISK_SWAP_PATH|d" /etc/fstab
    rm -f "$DISK_SWAP_PATH"
    _log "ç£ç›˜Swapå·²å¸è½½ã€‚"
}

# --- çŠ¶æ€æ˜¾ç¤º ---
do_status() {
    _title "æ··åˆSwapçŠ¶æ€æŠ¥å‘Š"
    swapon --show
    echo ""
    free -h
}

# --- ä¸»é€»è¾‘ ---
main() {
    if [ "$(id -u)" -ne 0 ]; then
        _error "æ­¤è„šæœ¬éœ€è¦ä»¥ root æƒé™è¿è¡Œã€‚"
    fi

    case "$1" in
        install|"")
            _title "å¼€å§‹éƒ¨ç½²æ··åˆSwapæ–¹æ¡ˆ..."
            do_uninstall_zram >/dev/null 2>&1
            do_uninstall_disk_swap >/dev/null 2>&1
            do_install_disk_swap
            do_install_zram
            sleep 2
            do_status
            _log "æ··åˆSwapæ–¹æ¡ˆéƒ¨ç½²å®Œæˆï¼"
            ;;
        uninstall)
            _title "å¼€å§‹å¸è½½æ··åˆSwapæ–¹æ¡ˆ..."
            do_uninstall_zram
            do_uninstall_disk_swap
            do_status
            _log "æ··åˆSwapæ–¹æ¡ˆå·²å®Œå…¨å¸è½½ã€‚"
            ;;
        status)
            do_status
            ;;
        *)
            echo "ç”¨æ³•: $0 [install|uninstall|status]"
            exit 1
            ;;
    esac
}

main "$@"

