gcloud config get-value project
nano 刷机脚本.sh

#!/bin/bash

# --- 俄勒冈8机加速版配置 ---

# 1. 项目 ID: (已根据您的信息填写)
PROJECT_ID="hallowed-trail-470604-k2"

# 2. 可用区: (已根据您的信息填写)
ZONE="us-west1-a"

# 3. 实例名称列表: (已为您更新为8台)
INSTANCES=("shuaji-1" "shuaji-2" "shuaji-3" "shuaji-4" "shuaji-5" "shuaji-6" "shuaji-7" "shuaji-8")

# --- 以下代码为优化版，无需修改 ---

echo "✅ 俄勒冈8机加速配置加载成功:"
echo "项目 ID: $PROJECT_ID"
echo "可用区: $ZONE"
echo "目标实例: ${INSTANCES[@]}"
echo "----------------------------------------"

while true; do
  echo "🚀 并发启动所有实例..."
  for INSTANCE in "${INSTANCES[@]}"; do
    gcloud compute instances start "$INSTANCE" --zone "$ZONE" --project "$PROJECT_ID" --quiet &
  done
  wait
  echo "⏳ 等待 45 秒..."
  sleep 45
  echo "🔍 开始高速检查所有实例 CPU..."
  FOUND_TARGET=""
  for INSTANCE in "${INSTANCES[@]}"; do
    echo -n "  -> 正在检查 $INSTANCE ... "
    CPU_PLATFORM=$(gcloud compute instances describe "$INSTANCE" --zone "$ZONE" --project "$PROJECT_ID" --format='value(cpuPlatform)')
    if [[ "$CPU_PLATFORM" == *"AMD"* ]]; then
      echo "🎉 命中 AMD！"
      FOUND_TARGET="$INSTANCE"
      break
    else
      echo "🚫 Intel"
    fi
  done
  if [[ -n "$FOUND_TARGET" ]]; then
    echo "----------------------------------------"
    echo "✅ 恭喜！实例 '$FOUND_TARGET' 是 AMD CPU！"
    echo "🛑 正在停止其他非目标实例..."
    for INSTANCE in "${INSTANCES[@]}"; do
      if [[ "$INSTANCE" != "$FOUND_TARGET" ]]; then
        gcloud compute instances stop "$INSTANCE" --zone "$ZONE" --project "$PROJECT_ID" --quiet &
      fi
    done
    wait
    echo "🎯 刷机任务完成！"
    break
  else
    echo "----------------------------------------"
    echo "🚫 本轮未命中。正在关停所有实例..."
    for INSTANCE in "${INSTANCES[@]}"; do
      gcloud compute instances stop "$INSTANCE" --zone "$ZONE" --project "$PROJECT_ID" --quiet &
    done
    wait
    echo "🔁 10秒后开始下一轮..."
    sleep 10
  fi
done


chmod +x 刷机脚本.sh
tmux
./刷机脚本.sh
